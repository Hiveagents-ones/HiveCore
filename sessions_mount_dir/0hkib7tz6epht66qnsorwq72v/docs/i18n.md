# 国际化实现文档

## 概述

本文档描述了课程预约系统的国际化（i18n）实现方案，包括前端的多语言支持、配置方法以及扩展指南。

## 技术栈

- **Vue I18n**: 用于 Vue 3 的国际化插件
- **Vite**: 构建工具，支持动态导入
- **JSON**: 语言包存储格式

## 目录结构

```
frontend/src/i18n/
├── index.js          # i18n 配置入口
└── locales/          # 语言包目录
    ├── en.json       # 英文语言包
    └── zh.json       # 中文语言包
```

## 配置说明

### 主配置文件 (index.js)

```javascript
import { createI18n } from 'vue-i18n';
import en from './locales/en.json';
import zh from './locales/zh.json';

const messages = {
  en,
  zh,
};

const i18n = createI18n({
  legacy: false,
  locale: 'zh', // 默认语言
  fallbackLocale: 'en', // 回退语言
  messages,
  globalInjection: true, // 全局注入$t函数
  silentTranslationWarn: true, // 静默翻译警告
  silentFallbackWarn: true, // 静默回退警告
});

export default i18n;
```

### 语言包格式

语言包采用 JSON 格式，支持嵌套结构。示例如下：

#### en.json
```json
{
  "common": {
    "confirm": "Confirm",
    "cancel": "Cancel",
    "save": "Save"
  },
  "course": {
    "title": "Course Schedule",
    "book": "Book",
    "cancel": "Cancel Booking",
    "full": "Full"
  }
}
```

#### zh.json
```json
{
  "common": {
    "confirm": "确认",
    "cancel": "取消",
    "save": "保存"
  },
  "course": {
    "title": "课程表",
    "book": "预约",
    "cancel": "取消预约",
    "full": "已满"
  }
}
```

## 使用方法

### 在组件中使用

```vue
<template>
  <div>
    <h1>{{ $t('course.title') }}</h1>
    <button>{{ $t('course.book') }}</button>
  </div>
</template>

<script setup>
// 可以通过 useI18n 获取更丰富的 API
import { useI18n } from 'vue-i18n';

const { t, locale } = useI18n();

// 切换语言
const switchLanguage = (lang) => {
  locale.value = lang;
};
</script>
```

### 在 JavaScript 中使用

```javascript
import { i18n } from '@/i18n';

// 直接翻译
const message = i18n.global.t('common.confirm');

// 切换语言
i18n.global.locale.value = 'en';
```

## 语言切换实现

### 1. 创建语言切换组件

```vue
<!-- components/LanguageSwitcher.vue -->
<template>
  <select v-model="currentLocale" @change="changeLanguage">
    <option value="zh">中文</option>
    <option value="en">English</option>
  </select>
</template>

<script setup>
import { ref } from 'vue';
import { useI18n } from 'vue-i18n';

const { locale } = useI18n();
const currentLocale = ref(locale.value);

const changeLanguage = () => {
  locale.value = currentLocale.value;
  localStorage.setItem('locale', currentLocale.value);
};
</script>
```

### 2. 持久化语言选择

在应用初始化时读取本地存储的语言设置：

```javascript
// main.js
import i18n from './i18n';

const savedLocale = localStorage.getItem('locale');
if (savedLocale) {
  i18n.global.locale.value = savedLocale;
}
```

## 最佳实践

### 1. 命名规范

- 使用嵌套结构组织翻译键
- 采用模块化命名（如 `course.title`, `user.profile`）
- 避免过深的嵌套（建议不超过3层）

### 2. 翻译键命名

```json
{
  "module": {
    "feature": {
      "action": "Translation"
    }
  }
}
```

### 3. 复数形式处理

```json
{
  "course": {
    "count": "No courses | {n} course | {n} courses"
  }
}
```

```javascript
// 使用
$t('course.count', 0) // No courses
$t('course.count', 1) // 1 course
$t('course.count', 5) // 5 courses
```

### 4. 日期和时间格式化

```javascript
import { useI18n } from 'vue-i18n';

const { d } = useI18n();

// 格式化日期
d(new Date(), 'short'); // 根据当前语言格式化
```

## 扩展指南

### 添加新语言

1. 在 `locales/` 目录下创建新的语言文件（如 `ja.json`）
2. 在 `index.js` 中导入并添加到 `messages` 对象
3. 更新语言切换组件的选项

### 动态加载语言包

对于大型应用，可以实现按需加载：

```javascript
const loadLocaleMessages = async (locale) => {
  const messages = await import(`./locales/${locale}.json`);
  i18n.global.setLocaleMessage(locale, messages.default);
};

// 使用
await loadLocaleMessages('ja');
i18n.global.locale.value = 'ja';
```

### 后端国际化

虽然本项目主要关注前端国际化，但后端也可以返回多语言错误消息：

```python
# FastAPI 示例
from fastapi import Request

@app.get("/api/courses")
async def get_courses(request: Request):
    accept_language = request.headers.get("accept-language", "en")
    # 根据语言返回相应消息
    return {"message": get_translated_message("courses_loaded", accept_language)}
```

## 注意事项

1. **性能考虑**: 语言包会随应用一起加载，避免过大的语言文件
2. **SEO优化**: 需要为不同语言设置不同的 URL 路径
3. **测试覆盖**: 确保所有语言版本的功能测试
4. **回退机制**: 设置合理的 `fallbackLocale` 避免缺失翻译
5. **工具集成**: 可以使用 i18n-ally 等 VS Code 插件提高开发效率

## 相关文件

- `frontend/src/i18n/index.js` - 主配置文件
- `frontend/src/views/CourseSchedule.vue` - 使用示例
- `frontend/src/components/LanguageSwitcher.vue` - 语言切换组件

## 更新日志

- v1.0.0: 初始实现，支持中英文切换
- v1.1.0: 添加本地存储持久化
- v1.2.0: 支持复数形式和日期格式化